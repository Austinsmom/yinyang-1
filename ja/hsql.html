<!doctype html>
<html>
<head>
	<meta charset="utf-8">

	<title>hSQL</title>
	<meta name="og:site_name" content="milk.coffee"/>
	<meta name="keywords" content="milk.coffee, template, js, javascript, hSQL">
	<meta name="description" content="hSQL(html Search Query Language)は、SQLに似た文法を持つ、HTMLファイルの検索クエリ言語です。">
	<meta name="author" content="CogniTom Academic Design">
	<meta name="copyright" content="&copy; 2012 - CogniTom Academic Design">
	
	<link rel="template" href="../style/template.html">
	<script src="../js/libs/jquery-1.7.1.min.js"></script>
	<script src="../js/milk/milk.js"></script>
</head>
<body>
	<p>hSQL(html Search Query Language)を使うと、テンプレートからhSQLを通じてサーバ上のファイルツリーとページ情報にアクセスできます。hSQLは、SQLに似た文法を持つ、HTMLファイルの検索クエリ言語です。例えば、</p>
	
	<pre><code>&lt;meta name=&quot;milk:hsql.posts&quot; content=&quot;SELECT * FROM ./  LIMIT 3&quot;&gt;
	</code></pre>
	
	<p>のように、特殊なMETAタグを埋め込むと、テンプレートからhsql.posts変数にアクセスできるようになります。この場合、カレントフォルダ内のページから、3つのページ(HTML)のデータを(新しい順で)取得します。hSQLの問合せ結果は、次のようなJSON形式になっており、そのまま変数にセットされます。</p>
	
	<pre><code>[
	    {
	        &quot;title&quot; : &quot;ミルクコーヒーの歴史&quot;,
	        &quot;description&quot; : &quot;開発の動機から、その実現に至るまでを概説します。&quot;,
	        &quot;file&quot; : &quot;history.html&quot;,
	        &quot;created&quot; : &quot;2012-01-28T21:18+09:00&quot;,
	        &quot;modified&quot; : &quot;2012-01-28T21:18+09:18&quot;
	    },
	    {
	        &quot;title&quot; : &quot;ミルクコーヒーの淹れ方&quot;,
	        …省略
	    },
	    …省略
	]
	</code></pre>
	
	<p>なお、hSQLを使うには、サーバサイドにヘルパーファイルが必要です。現在のところPHPに対応したファイルが提供されています。下記の2つのファイルをドキュメントルートに配置します。</p>
	
	<ul>
	<li>hsql.php</li>
	<li>.htaccess</li>
	</ul>
	
	<h3>hSQLの文法</h3>
	
	<h4>SELECT節</h4>
	
	<p>SQLではデータベースのカラムをSELECT節で指定するのが一般的ですが、hSQLでは、ファイル情報・HTMLのメタ情報・ HTMLタグ が、その対象です。</p>
	
	<ul>
	<li>ファイル情報
	
	<ul>
	<li>file.name</li>
	<li>file.created</li>
	<li>file.modified</li>
	</ul></li>
	<li>HTMLのメタ情報
	
	<ul>
	<li>meta.description</li>
	<li>meta.author</li>
	</ul></li>
	<li>HTMLタグ (CSSセレクタでアクセス)
	
	<ul>
	<li>@title → TITLEタグの中身</li>
	<li>@div#main h3 → jQueryでいうところの、$(&#39;div#main h3&#39;).text()</li>
	</ul></li>
	</ul>
	
	<p>など。</p>
	
	<p>「as 〜」とすることで、カラム名を設定できます。省略した場合は、次のルールが適用されます。</p>
	
	<ul>
	<li>ファイル情報 or HTMLのメタ情報
	
	<ul>
	<li>xxx.yyy → yyy</li>
	</ul></li>
	<li>HTMLタグ
	
	<ul>
	<li>@xxx → xxx</li>
	<li>@xxx#yyy → xxx_yyy</li>
	<li>@xxx#yyy zzz.www → xxx_yyy_zzz_www</li>
	</ul></li>
	</ul>
	
	<p>なお、ワイルドカード「*」が許されていますが、SQLと違い、これはよく使う表現へのショートハンドとなっています。</p>
	
	<pre><code>SELECT * FROM ./ LIMIT 3
	</code></pre>
	
	<p>と書いた場合、</p>
	
	<pre><code>SELECT
	    @title as title,
	    meta.description as description,
	    file.name as file,
	    file.created as created,
	    file.modified as modified
	FROM
	    ./
	LIMIT
	    3
	</code></pre>
	
	<p>としてhSQLが実行されます。</p>
	
	<h4>WHERE節</h4>
	
	<p>WHERE節は省略可能です。</p>
	
	<p>例えば、METAキーワードとして「hot」が指定されているものに限定する場合、</p>
	
	<pre><code>WHERE meta.keyword HAS &#39;hot&#39;
	</code></pre>
	
	<p>と指定すればOKです。HASは文字列を含む場合に真となる演算子です。文字列はシングルコーテーション「&#39;」で囲みます。</p>
	
	<p>WHERE節で使える演算子には、次のものがあります。</p>
	
	<ul>
	<li>等号 : =, IS</li>
	<li>不等号 : &lt;&gt;, IS NOT</li>
	<li>不等号 : &lt;, &gt;, &lt;=, &gt;=</li>
	<li>含有 : HAS</li>
	</ul>
	
	<h4>ORDER BY節</h4>
	
	<p>ORDER BY節は省略可能です。省略した場合は、</p>
	
	<pre><code>ORDER BY file.created DESC
	</code></pre>
	
	<p>が指定されたものとみなします。</p>
	
	<h4>LIMIT節</h4>
	
	<p>LIMIT節は省略可能です。省略した場合は、</p>
	
	<pre><code>LIMIT 10
	</code></pre>
	
	<p>が指定されたものとみなします。</p>
	
	<h3>hSQLからページを隠す</h3>
	
	<p>ドキュメントHTMLに、次のMETAタグを挿入すると、hSQLの検索から排除することができます。</p>
	
	<pre><code>&lt;meta name=&quot;hsql:searchable&quot; content=&quot;false&quot;&gt;
	</code></pre>
</body>
</html>
